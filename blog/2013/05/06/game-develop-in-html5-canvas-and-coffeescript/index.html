
<!DOCTYPE HTML>
<html>
<head>
	<meta charset="utf-8">
	<title>Game develop in HTML5 canvas and coffeescript - BenCao Blog</title>
	<meta name="author" content="Ben Cao">

	
	<meta name="description" content="Game Develop in HTML5 Canvas and Coffeescript In the past a few months, I tried to rebuild the classical FC tank game in coffeescript. The final &hellip;">
	

  <!-- http://t.co/dKP3o1e -->
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">

	<link href="/atom.xml" rel="alternate" title="BenCao Blog" type="application/atom+xml">
	
	<link rel="canonical" href="http://blog.bencao.it/blog/2013/05/06/game-develop-in-html5-canvas-and-coffeescript/">
	<link href="/favicon.png" rel="shortcut icon">
	<link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
	<!--[if lt IE 9]><script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script><![endif]-->
	<script src="//ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.min.js"></script>
	<link href='http://fonts.googleapis.com/css?family=Open+Sans:400italic,400,700' rel='stylesheet' type='text/css'>
	<!--Fonts from Google"s Web font directory at http://google.com/webfonts -->
<link href="http://fonts.googleapis.com/css?family=PT+Serif:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">
<link href="http://fonts.googleapis.com/css?family=PT+Sans:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">

<!-- Deck.js -->
<!-- Style theme. Located in /themes/style/ or create your own. -->
<link rel="stylesheet" href="/stylesheets/deck.js/themes/style/.css" type='text/css'>
<!-- Transition theme. Located in /themes/transition/ or create your own. -->
<link rel="stylesheet" href="/stylesheets/deck.js/themes/transition/.css" type='text/css'>

<script type="text/javascript" src="/javascripts/modernizr-2.0.js"></script>

</head>


<body>
	<div class="container">
		<div class="left-col">
			<div class="intrude-less">
			<header id="header" class="inner"><div class="profilepic">	
	<script src="/javascripts/md5.js"></script>
	<script type="text/javascript">
		document.write("<img src='http://www.gravatar.com/avatar/" + MD5("") + "?s=160' alt='Profile Picture' style='width: 160px;'");
	</script>
</div>
<h1><a href="/">BenCao Blog</a></h1>
<p class="subtitle">tech life</p>
<nav id="main-nav"><ul class="main-navigation">
  <li><a href="/">Blog</a></li>
  <li><a href="/blog/archives">Archives</a></li>
  <li><a href="/slides">Slides</a></li>
</ul>
</nav>
<nav id="sub-nav">
	<div class="social">
		
		
		
		
		<a class="github" href="https://github.com/bencao" title="GitHub">GitHub</a>
		
		
		
		
		
		
		<a class="rss" href="/atom.xml" title="RSS">RSS</a>
		
	</div>
</nav>

</header>				
			</div>
		</div>	
		<div class="mid-col">
			
				
			
			<div class="mid-col-container">
				<div id="content" class="inner"><article class="post" itemscope itemtype="http://schema.org/BlogPosting">
	<h1 class="title" itemprop="name">Game Develop in HTML5 Canvas and Coffeescript</h1>
	<div class="entry-content" itemprop="articleBody"><p>In the past a few months, I tried to rebuild the classical FC tank game in coffeescript.</p>

<p>The final work is <a href="http://blog.bencao.it/fc_tank">here</a>.</p>

<p><img src="/images/posts/tank_welcome_scene.png">
<img src="/images/posts/tank_game_scene.png"></p>

<p>It&#8217;s an interesting journey, and following aspects are what I feel worth mentioning.</p>

<h1>Game Basics</h1>

<h2>The law of frame</h2>

<p>The most foundamental thing before developing a game is to understand FPS - frame per second, and how the game world are running in a frame by frame law.</p>

<p>Before each frame was drawn, game program need to calculate the position, direction, speed, and other attributes for each moving objects(display object) in screen.
The higher the fps is, the smoother users feel. Typical refresh rate of LCD screen is 60Hz, so it&#8217;s good enough to set 60 fps as our goal.
This set a great challenge for game developers because some parts may sometimes take a lot of CPU time.
Great game need a great performance optimization.</p>

<p>Here&#8217;s the core loop of Tank time line:</p>

<figure class='code'><figcaption><span>Tank Core Loop  </span></figcaption>
 <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
</pre></td><td class='code'><pre><code class='coffeescript'><span class='line'><span class="nv">start_time_line: </span><span class="p">()</span> <span class="nf">-&gt;</span>
</span><span class='line'>  <span class="nv">last_time = </span><span class="k">new</span> <span class="nb">Date</span><span class="p">()</span>
</span><span class='line'>  <span class="vi">@timeline = </span><span class="nx">setInterval</span><span class="p">(()</span> <span class="o">=&gt;</span>
</span><span class='line'>    <span class="nv">current_time = </span><span class="k">new</span> <span class="nb">Date</span><span class="p">()</span>
</span><span class='line'>    <span class="c1"># assume a frame will never last more than 1 second</span>
</span><span class='line'>    <span class="nv">delta_time = </span><span class="nx">current_time</span><span class="p">.</span><span class="nx">getMilliseconds</span><span class="p">()</span> <span class="o">-</span> <span class="nx">last_time</span><span class="p">.</span><span class="nx">getMilliseconds</span><span class="p">()</span>
</span><span class='line'>    <span class="nx">delta_time</span> <span class="o">+=</span> <span class="mi">1000</span> <span class="k">if</span> <span class="nx">delta_time</span> <span class="o">&lt;</span> <span class="mi">0</span>
</span><span class='line'>    <span class="nx">_</span><span class="p">.</span><span class="nx">each</span><span class="p">(</span><span class="nx">@map</span><span class="p">.</span><span class="nx">missiles</span><span class="p">,</span> <span class="nf">(unit) -&gt;</span> <span class="nx">unit</span><span class="p">.</span><span class="nx">integration</span><span class="p">(</span><span class="nx">delta_time</span><span class="p">))</span>
</span><span class='line'>    <span class="nx">_</span><span class="p">.</span><span class="nx">each</span><span class="p">(</span><span class="nx">@map</span><span class="p">.</span><span class="nx">gifts</span><span class="p">.</span><span class="nx">concat</span><span class="p">(</span><span class="nx">@map</span><span class="p">.</span><span class="nx">tanks</span><span class="p">),</span> <span class="nf">(unit) -&gt;</span> <span class="nx">unit</span><span class="p">.</span><span class="nx">integration</span><span class="p">(</span><span class="nx">delta_time</span><span class="p">))</span>
</span><span class='line'>    <span class="nx">_</span><span class="p">.</span><span class="nx">each</span><span class="p">(</span><span class="nx">@map</span><span class="p">.</span><span class="nx">missiles</span><span class="p">,</span> <span class="nf">(unit) -&gt;</span> <span class="nx">unit</span><span class="p">.</span><span class="nx">integration</span><span class="p">(</span><span class="nx">delta_time</span><span class="p">))</span>
</span><span class='line'>    <span class="nv">last_time = </span><span class="nx">current_time</span>
</span><span class='line'>    <span class="nx">@frame_rate</span> <span class="o">+=</span> <span class="mi">1</span>
</span><span class='line'>  <span class="p">,</span> <span class="nb">parseInt</span><span class="p">(</span><span class="mi">1000</span><span class="o">/</span><span class="nx">@fps</span><span class="p">))</span>
</span><span class='line'>  <span class="c1"># show frame rate</span>
</span><span class='line'>  <span class="vi">@frame_timeline = </span><span class="nx">setInterval</span><span class="p">(()</span> <span class="o">=&gt;</span>
</span><span class='line'>    <span class="nx">@frame_rate_label</span><span class="p">.</span><span class="nx">setText</span><span class="p">(</span><span class="nx">@frame_rate</span> <span class="o">+</span> <span class="s">&quot; fps&quot;</span><span class="p">)</span>
</span><span class='line'>    <span class="vi">@frame_rate = </span><span class="mi">0</span>
</span><span class='line'>  <span class="p">,</span> <span class="mi">1000</span><span class="p">)</span>
</span></code></pre></td></tr></table></div></figure>


<h2>Path finding</h2>

<p>In many kinds of games, enemies have some degree of AI. They need to move across certain paths or towards some targets.
Terrains might be different, also they may be changing all the time, we need to do frequent calculation in order to find out the best path.</p>

<p>There are many path finding algorithm, the most common ones are: Dijikstra and A star, while A star is sightly improve Dijikstra by adding a weight base on the &#8220;distance&#8221; of current position to target position.
Here&#8217;s a wonderful site demonstrate the Path finding algorithm very well: <a href="http://qiao.github.io/PathFinding.js/visual/">PathFinding.js</a>.</p>

<h2>Enemy AI</h2>

<p>AI differs in different kind of games.</p>

<p>For tank, here is the list I considered to be important:</p>

<ul>
<li>Where to move</li>
<li>When to fire</li>
<li>Adjustable AI</li>
</ul>


<h2>Scenes</h2>

<p>A game can be divided into several scenes, these scenes should be easy switchable and be properly designed to have its own preparation and cleaning functions.
While each scene should be designed as individual as possible, a global storage must be there which can be used by scenes to share data.</p>

<p>For Example, tank game is divided into</p>

<ul>
<li>welcome scene</li>
<li>stage scene</li>
<li>game scene</li>
<li>report scene</li>
<li>hi_score scene</li>
</ul>


<p>Each scene has a start/stop method which doing prepare/clearing stuffs. The global storage is the instance of game. Take stage scene as example:</p>

<figure class='code'><figcaption><span>Stage start and stop  </span></figcaption>
 <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
</pre></td><td class='code'><pre><code class='coffeescript'><span class='line'><span class="k">class</span> <span class="nx">StageScene</span> <span class="k">extends</span> <span class="nx">Scene</span>
</span><span class='line'>  <span class="nv">constructor: </span><span class="nf">(@game) -&gt;</span>
</span><span class='line'>    <span class="k">super</span><span class="p">(</span><span class="nx">@game</span><span class="p">)</span>
</span><span class='line'>    <span class="nx">@init_stage_nodes</span><span class="p">()</span>
</span><span class='line'>
</span><span class='line'>  <span class="nv">start: </span><span class="p">()</span> <span class="nf">-&gt;</span>
</span><span class='line'>    <span class="k">super</span><span class="p">()</span>
</span><span class='line'>    <span class="vi">@current_stage = </span><span class="nx">@game</span><span class="p">.</span><span class="nx">get_config</span><span class="p">(</span><span class="s">&#39;current_stage&#39;</span><span class="p">)</span>
</span><span class='line'>    <span class="nx">@update_stage_label</span><span class="p">()</span>
</span><span class='line'>    <span class="k">if</span> <span class="nx">@game</span><span class="p">.</span><span class="nx">get_config</span><span class="p">(</span><span class="s">&#39;stage_autostart&#39;</span><span class="p">)</span>
</span><span class='line'>      <span class="nx">setTimeout</span><span class="p">((()</span> <span class="o">=&gt;</span> <span class="nx">@game</span><span class="p">.</span><span class="nx">switch_scene</span><span class="p">(</span><span class="s">&#39;game&#39;</span><span class="p">)),</span> <span class="mi">2000</span><span class="p">)</span>
</span><span class='line'>    <span class="k">else</span>
</span><span class='line'>      <span class="nx">@enable_stage_control</span><span class="p">()</span>
</span><span class='line'>
</span><span class='line'>  <span class="nv">stop: </span><span class="p">()</span> <span class="nf">-&gt;</span>
</span><span class='line'>    <span class="k">super</span><span class="p">()</span>
</span><span class='line'>    <span class="nx">@disable_stage_control</span><span class="p">()</span>
</span><span class='line'>    <span class="nx">@prepare_for_game_scene</span><span class="p">()</span>
</span></code></pre></td></tr></table></div></figure>


<h2>Stage design and Tiled map</h2>

<p>It&#8217;s possible to design stage by a few lines of code. But normal users can not easily do that.
I started to think whether a GUI tool exists. And I found Tiled map.</p>

<p>Tiled map is an ecosystem which contains a 2D sprite based map format standard and a set of cross platform GUI tools and cross language map readers and writers.
Its json definition is so easy readable that I directly read the data from the json export from a tiled output.</p>

<p>Use tiled made adding new stage easy and possible for non-programers to get involved.</p>

<p><img src="/images/posts/tiled_screen_capture.png"></p>

<h2>User input handling</h2>

<p>The challenge is to transfer simulated user input signals to digital signals.</p>

<p>A variety of user input devices are available now. The most frequently used devices today are keyboard, mouse and touch screen.
I choosed keyboard. There are 3 types of keyboard events, keyup, keydown, keypress.</p>

<p>Here&#8217;s the code logic I used to handle keyboard input:</p>

<figure class='code'><figcaption><span>Input handling  </span></figcaption>
 <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
<span class='line-number'>51</span>
<span class='line-number'>52</span>
<span class='line-number'>53</span>
<span class='line-number'>54</span>
<span class='line-number'>55</span>
<span class='line-number'>56</span>
<span class='line-number'>57</span>
<span class='line-number'>58</span>
<span class='line-number'>59</span>
</pre></td><td class='code'><pre><code class='coffeescript'><span class='line'><span class="k">class</span> <span class="nx">UserCommander</span> <span class="k">extends</span> <span class="nx">Commander</span>
</span><span class='line'>  <span class="nv">constructor: </span><span class="nf">(@map_unit, key_setting) -&gt;</span>
</span><span class='line'>    <span class="k">super</span><span class="p">(</span><span class="nx">@map_unit</span><span class="p">)</span>
</span><span class='line'>    <span class="vi">@key_map = </span><span class="p">{}</span>
</span><span class='line'>    <span class="k">for</span> <span class="nx">key</span><span class="p">,</span> <span class="nx">code</span> <span class="k">of</span> <span class="nx">key_setting</span>
</span><span class='line'>      <span class="nx">@key_map</span><span class="p">[</span><span class="nx">code</span><span class="p">]</span> <span class="o">=</span> <span class="nx">key</span>
</span><span class='line'>    <span class="vi">@key_status = </span><span class="p">{</span>
</span><span class='line'>      <span class="nv">up: </span><span class="kc">false</span><span class="p">,</span>
</span><span class='line'>      <span class="nv">down: </span><span class="kc">false</span><span class="p">,</span>
</span><span class='line'>      <span class="nv">left: </span><span class="kc">false</span><span class="p">,</span>
</span><span class='line'>      <span class="nv">right: </span><span class="kc">false</span><span class="p">,</span>
</span><span class='line'>      <span class="nv">fire: </span><span class="kc">false</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'>    <span class="nx">@reset_input</span><span class="p">()</span>
</span><span class='line'>
</span><span class='line'>  <span class="nv">reset_input: </span><span class="p">()</span> <span class="nf">-&gt;</span> <span class="vi">@inputs = </span><span class="p">{</span> <span class="nv">up: </span><span class="p">[],</span> <span class="nv">down: </span><span class="p">[],</span> <span class="nv">left: </span><span class="p">[],</span> <span class="nv">right: </span><span class="p">[],</span> <span class="nv">fire: </span><span class="p">[]</span> <span class="p">}</span>
</span><span class='line'>  <span class="nv">is_pressed: </span><span class="nf">(key) -&gt;</span> <span class="nx">@key_status</span><span class="p">[</span><span class="nx">key</span><span class="p">]</span>
</span><span class='line'>  <span class="nv">set_pressed: </span><span class="nf">(key, bool) -&gt;</span> <span class="nx">@key_status</span><span class="p">[</span><span class="nx">key</span><span class="p">]</span> <span class="o">=</span> <span class="nx">bool</span>
</span><span class='line'>
</span><span class='line'>  <span class="nv">next: </span><span class="nf">-&gt;</span>
</span><span class='line'>    <span class="nx">@handle_key_up_key_down</span><span class="p">()</span>
</span><span class='line'>    <span class="nx">@handle_key_press</span><span class="p">()</span>
</span><span class='line'>
</span><span class='line'>  <span class="nv">handle_key_up_key_down: </span><span class="p">()</span> <span class="nf">-&gt;</span>
</span><span class='line'>    <span class="k">for</span> <span class="nx">key</span><span class="p">,</span> <span class="nx">types</span> <span class="k">of</span> <span class="nx">@inputs</span>
</span><span class='line'>      <span class="k">continue</span> <span class="k">if</span> <span class="nx">_</span><span class="p">.</span><span class="nx">isEmpty</span><span class="p">(</span><span class="nx">types</span><span class="p">)</span>
</span><span class='line'>      <span class="k">switch</span> <span class="p">(</span><span class="nx">key</span><span class="p">)</span>
</span><span class='line'>        <span class="k">when</span> <span class="s">&quot;fire&quot;</span>
</span><span class='line'>          <span class="nx">@fire</span><span class="p">()</span>
</span><span class='line'>        <span class="k">when</span> <span class="s">&quot;up&quot;</span><span class="p">,</span> <span class="s">&quot;down&quot;</span><span class="p">,</span> <span class="s">&quot;left&quot;</span><span class="p">,</span> <span class="s">&quot;right&quot;</span>
</span><span class='line'>          <span class="k">if</span> <span class="nx">@direction_changed</span><span class="p">(</span><span class="nx">key</span><span class="p">)</span>
</span><span class='line'>            <span class="nx">@turn</span><span class="p">(</span><span class="nx">key</span><span class="p">)</span>
</span><span class='line'>            <span class="k">break</span>
</span><span class='line'>          <span class="nv">keyup = </span><span class="nx">_</span><span class="p">.</span><span class="nx">contains</span><span class="p">(</span><span class="nx">@inputs</span><span class="p">[</span><span class="nx">key</span><span class="p">],</span> <span class="s">&quot;keyup&quot;</span><span class="p">)</span>
</span><span class='line'>          <span class="nv">keydown = </span><span class="nx">_</span><span class="p">.</span><span class="nx">contains</span><span class="p">(</span><span class="nx">@inputs</span><span class="p">[</span><span class="nx">key</span><span class="p">],</span> <span class="s">&quot;keydown&quot;</span><span class="p">)</span>
</span><span class='line'>          <span class="k">if</span> <span class="nx">keydown</span>
</span><span class='line'>            <span class="nx">@start_move</span><span class="p">()</span>
</span><span class='line'>          <span class="k">else</span>
</span><span class='line'>            <span class="nx">@stop_move</span><span class="p">()</span> <span class="k">if</span> <span class="nx">keyup</span>
</span><span class='line'>    <span class="nx">@reset_input</span><span class="p">()</span>
</span><span class='line'>
</span><span class='line'>  <span class="nv">handle_key_press: </span><span class="p">()</span> <span class="nf">-&gt;</span>
</span><span class='line'>    <span class="k">for</span> <span class="nx">key</span> <span class="k">in</span> <span class="p">[</span><span class="s">&quot;up&quot;</span><span class="p">,</span> <span class="s">&quot;down&quot;</span><span class="p">,</span> <span class="s">&quot;left&quot;</span><span class="p">,</span> <span class="s">&quot;right&quot;</span><span class="p">]</span>
</span><span class='line'>      <span class="k">if</span> <span class="nx">@is_pressed</span><span class="p">(</span><span class="nx">key</span><span class="p">)</span>
</span><span class='line'>        <span class="nx">@turn</span><span class="p">(</span><span class="nx">key</span><span class="p">)</span>
</span><span class='line'>        <span class="nx">@start_move</span><span class="p">()</span>
</span><span class='line'>    <span class="k">if</span> <span class="nx">@is_pressed</span><span class="p">(</span><span class="s">&quot;fire&quot;</span><span class="p">)</span>
</span><span class='line'>      <span class="nx">@fire</span><span class="p">()</span>
</span><span class='line'>
</span><span class='line'>  <span class="nv">add_key_event: </span><span class="nf">(type, key_code) -&gt;</span>
</span><span class='line'>    <span class="k">return</span> <span class="kc">true</span> <span class="k">if</span> <span class="nx">_</span><span class="p">.</span><span class="nx">isUndefined</span><span class="p">(</span><span class="nx">@key_map</span><span class="p">[</span><span class="nx">key_code</span><span class="p">])</span>
</span><span class='line'>    <span class="nv">key = </span><span class="nx">@key_map</span><span class="p">[</span><span class="nx">key_code</span><span class="p">]</span>
</span><span class='line'>    <span class="k">switch</span> <span class="nx">type</span>
</span><span class='line'>      <span class="k">when</span> <span class="s">&quot;keyup&quot;</span>
</span><span class='line'>        <span class="nx">@set_pressed</span><span class="p">(</span><span class="nx">key</span><span class="p">,</span> <span class="kc">false</span><span class="p">)</span>
</span><span class='line'>        <span class="nx">@inputs</span><span class="p">[</span><span class="nx">key</span><span class="p">].</span><span class="nx">push</span><span class="p">(</span><span class="s">&quot;keyup&quot;</span><span class="p">)</span>
</span><span class='line'>      <span class="k">when</span> <span class="s">&quot;keydown&quot;</span>
</span><span class='line'>        <span class="nx">@set_pressed</span><span class="p">(</span><span class="nx">key</span><span class="p">,</span> <span class="kc">true</span><span class="p">)</span>
</span><span class='line'>        <span class="nx">@inputs</span><span class="p">[</span><span class="nx">key</span><span class="p">].</span><span class="nx">push</span><span class="p">(</span><span class="s">&quot;keydown&quot;</span><span class="p">)</span>
</span></code></pre></td></tr></table></div></figure>


<h2>Tunning Numbers</h2>

<p>Most number settings that are obvious were borrowed from origin FC tank game, such as tank life, missile power, terrain properties and so on.</p>

<p>Others such as enemy tank IQ are defined according to feelings. At first there&#8217;s no enemy IQ concept and I found enemies always rush to me in shortest paths, what a nightmare!
So I have to import an IQ concept which is actually the hundred percent rate that they choose the right target - user&#8217;s home, otherwise they rush to a random area in map.
Enemies are becoming smarter and smarter along with user entering into later stages.</p>

<h2>Tunning Performance</h2>

<h3>Drawing Library is the most important factor to final performance</h3>

<p>I&#8217;ve tried <a href="http://raphaeljs.com/">Rapheal</a>, <a href="http://ocanvas.org/">oCanvas</a> and <a href="http://kineticjs.com/">Kinetic</a>.
And Kinetic is my final choice because it&#8217;s base on HTML5 canvas, its API is programer friendly and its performance is much better than oCanvas.</p>

<h3>Improve path finding using advance data structure</h3>

<p>I can&#8217;t find a existing implementation of Binomial Heap in Javascript, so I wrote one.
It reduces each path finding time from around 700ms to less than 50ms.</p>

<h1>Why I love Coffeescript more than Javascript</h1>

<ul>
<li>easy and intuitive class inheritance</li>
<li>simpler array/hash iteration</li>
<li>@ instead of this</li>
<li>shorthand for function definition</li>
</ul>


<h1>Unit Test and Continuous Integration</h1>

<p>You really should try the excellent CI tool <a href="https://travis-ci.org/">Travis-CI</a>. It support running unit tests in a variety of environments and is already seamlessly integrated with Github.</p>

<p>The unit test tool I used is QUnit.</p>

<h1>Possible improvements</h1>

<h2>Larger and custom map</h2>

<h2>Multi-user online game</h2>
</div>

</article>

	<div class="share">
	<div class="addthis_toolbox addthis_default_style ">
	
	
	<a class="addthis_button_tweet"></a>
	
	
	<a class="addthis_counter addthis_pill_style"></a>
	</div>
  <script type="text/javascript" src="http://s7.addthis.com/js/250/addthis_widget.js#pubid="></script>
</div>



<section id="comment">
    <h1 class="title">Comments</h1>
    <div id="disqus_thread" aria-live="polite"><noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
</div>
</section>
</div>
			</div>
			<footer id="footer" class="inner"><p>
  Copyright &copy; 2013 - Ben Cao -
  <span class="credit">Powered by <a href="http://octopress.org">Octopress</a></span>
</p>

Design credit: <a href="http://shashankmehta.in/archive/2012/greyshade.html">Shashank Mehta</a></footer>
			<script src="/javascripts/slash.js"></script>
<script src="/javascripts/jquery.fancybox.pack.js"></script>
<script type="text/javascript">
(function($){
	$('.fancybox').fancybox();
})(jQuery);
</script> <!-- Delete or comment this line to disable Fancybox -->


<script type="text/javascript">
      var disqus_shortname = 'bencao-blog';
      
        
        // var disqus_developer = 1;
        var disqus_identifier = 'http://blog.bencao.it/blog/2013/05/06/game-develop-in-html5-canvas-and-coffeescript/';
        var disqus_url = 'http://blog.bencao.it/blog/2013/05/06/game-develop-in-html5-canvas-and-coffeescript/';
        var disqus_script = 'embed.js';
      
    (function () {
      var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
      dsq.src = 'http://' + disqus_shortname + '.disqus.com/' + disqus_script;
      (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    }());
</script>






		</div>
	</div>
</body>
</html>
